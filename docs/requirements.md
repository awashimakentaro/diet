# requirements.md（最終版 / v1）

本ドキュメントは、Diet App（仮称）の v1 における
**機能・振る舞い・思想を完全に定義する最上位仕様書**である。

本書は agents.md や設計書よりも優先され、
実装は本仕様から逸脱してはならない。

---

## 1. プロダクト概要

### 1.1 目的
- 食事内容をテキスト入力または画像入力で記録する
- カロリーおよび PFC（Protein/Fat/Carbs）を自動算出する
- 1日の摂取状況と目標との差分を可視化する
- よく使うメニューを保存・再利用できるようにする

### 1.2 想定ユーザー
- v1 は個人利用が中心
- ただし将来的なユーザー化・公開を前提とした設計とする

### 1.3 対象プラットフォーム
- React Native（Expo）
- iOS 優先（将来 Android / Web 拡張可能）

---

## 2. 全体構成

### 2.1 タブ構成
- 記録（Record）
- 履歴（History）
- 食品（Foods）
- 設定（Settings）

---

## 3. 機能要件（画面別）

### 3.1 記録タブ（Record）

#### 3.1.1 本日のサマリー
- 今日の合計：
  - カロリー
  - P / F / C
- 目標値との差分をバー表示
- 計算根拠：当日の履歴（meals）の合計

#### 3.1.2 入力
- テキスト入力欄
- 送信ボタン
- カメラボタン（画像入力）

##### テキスト解析
- 自然文を AI に送信
- 食品カード群 + 仮の menu_name を生成

##### 画像解析
- 撮影画像を解析
- 失敗時はエラー表示のみ（フォールバックなし）

#### 3.1.3 編集
- 生成されたメニューは保存前に自由に編集可能
  - menu_name
  - original_text
  - 食品カードの追加 / 削除 / 編集
  - amount（完全自由入力）
  - kcal / P / F / C

#### 3.1.4 保存
- 保存すると履歴に追加
- サマリーを即時更新
- 保存後、入力状態はリセット

---

### 3.2 履歴タブ（History）

#### 3.2.1 日付操作
- 前日 / 翌日切り替え
- 選択日の履歴のみ表示

#### 3.2.2 メニュー一覧
- menu_name
- original_text
- 食品リスト
- 合計 kcal / PFC
- 記録時刻

#### 3.2.3 操作
- 編集（フル編集可能）
- 削除（物理削除）
- 食品に保存
- 当日の履歴を一括削除

#### 3.2.4 編集内容
- menu_name
- original_text
- 食品カード（追加/削除/編集）
- 合計は再計算

---

### 3.3 食品タブ（Foods）

#### 3.3.1 概要
- よく使うメニュー / 単品食品を保存するライブラリ

#### 3.3.2 保存単位
- 単品食品
- 複数食品からなるメニュー
（両方を許可）

#### 3.3.3 機能
- 一覧表示
- 検索
- 追加 / 編集 / 削除（物理）
- 「今日食べた」ボタン
  - 押すと即履歴に追加（編集なし）

---

### 3.4 設定タブ（Settings）

#### 3.4.1 手動目標設定
- kcal / P / F / C
- 保存で即反映

#### 3.4.2 体格情報から自動計算
- 性別
- 年齢
- 身長
- 現在体重
- 目標体重
- 期間
- 活動レベル

- 自動計算結果を表示
- 「反映」ボタンで goals に保存

#### 3.4.3 通知
- 0時通知 ON / OFF
- 当日の過不足を通知

---

## 4. AI要件

- 入力：テキスト or 画像
- 出力：**JSONのみ**
- 不明な食品は推定で補完
- 正確性より編集前提の速度を優先

---

## 5. 削除ポリシー

- v1 は **すべて物理削除**
- 削除したデータは復元不可

---

## 6. v1 完了条件

- 記録 → 編集 → 保存 → 履歴反映
- 履歴編集 / 削除 / 一括削除
- 食品保存 / 再利用
- 目標設定 / 自動計算
- サマリー表示

